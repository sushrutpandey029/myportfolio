{% extends "base/base.html" %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/video_detail.css') }}">
{% endblock %}

{% block content %}
<div class="video-detail-wrapper relative min-h-screen">
    <!-- Background (optional - add if needed) -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none -z-10">
        <div class="w-96 h-96 bg-primary/10 blur-[120px] absolute top-20 left-10 animate-pulse"></div>
        <div class="w-[500px] h-[500px] bg-secondary/10 blur-[130px] absolute bottom-20 right-10 animate-pulse"
            style="animation-delay: 2s;"></div>
    </div>

    <!-- Content wrapper -->
    <main class="max-w-7xl mx-auto px-4 md:px-6 lg:px-8 pb-16">
        <!-- Breadcrumb -->
        <nav class="py-4 mb-6">
            <ol class="flex items-center gap-2 text-sm">
                <li><a href="{{ url_for('youtube.videos_list') }}"
                        class="breadcrumb-link hover:text-primary transition-colors">Videos</a></li>
                <li class="text-text-muted">/</li>
                <li class="text-white font-medium">{{ video.title }}</li>
            </ol>
        </nav>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column - Video Player & Description -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Video Player -->
                <div class="video-player-container scroll-reveal">
                    <div class="video-player-wrapper">
                        <iframe src="https://www.youtube.com/embed/{{ video.video_id }}"
                            title="{{ video.title }}" frameborder="0"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                            allowfullscreen>
                        </iframe>
                    </div>
                </div>

                <!-- Video Info -->
                <div class="description-card scroll-reveal">
                    <div class="flex items-start justify-between mb-4">
                        <span class="category-badge">{{ video.category or 'Tutorial' }}</span>
                        <div class="flex items-center gap-2">
                            <button class="share-btn" title="Share">
                                <span class="material-symbols-outlined text-white text-[20px]">share</span>
                            </button>
                        </div>
                    </div>

                    <h1 class="text-3xl md:text-4xl font-black text-white mb-4 leading-tight">
                        {{ video.title }}
                    </h1>

                    <div class="flex flex-wrap items-center gap-4 mb-6">
                        <div class="stats-badge">
                            <span class="material-symbols-outlined stats-icon">visibility</span>
                            <div>
                                <div class="stats-value">{{ video.view_count or '0' }}</div>
                                <div class="stats-label">Views</div>
                            </div>
                        </div>
                        <div class="stats-badge">
                            <span class="material-symbols-outlined stats-icon">schedule</span>
                            <div>
                                <div class="stats-value">{{ video.duration or '0:00' }}</div>
                                <div class="stats-label">Duration</div>
                            </div>
                        </div>
                        <div class="stats-badge">
                            <span class="material-symbols-outlined stats-icon">calendar_today</span>
                            <div>
                                <div class="stats-value">{{ video.created_at.strftime('%b %d') if video.created_at
                                    else 'Recent' }}</div>
                                <div class="stats-label">Published</div>
                            </div>
                        </div>
                    </div>

                    <div class="border-t border-white/10 pt-6">
                        <h2 class="text-lg font-bold text-white mb-3">Description</h2>
                        <p class="text-text-secondary leading-relaxed">
                            {{ video.description or 'No description available for this video.' }}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Right Column - Related Videos -->
            <div class="lg:col-span-1">
                <div class="sticky top-24 space-y-6">
                    <h2 class="text-2xl font-black text-white">Related Videos</h2>

                    {% if related_videos %}
                    <div class="space-y-4">
                        {% for related in related_videos %}
                        <a href="{{ url_for('youtube.video_detail', video_id=related.id) }}"
                            class="related-video-card block scroll-reveal">
                            <div class="related-video-thumbnail">
                                <img src="https://img.youtube.com/vi/{{ related.video_id }}/hqdefault.jpg"
                                    alt="{{ related.title }}">
                                <div class="play-overlay-small">
                                    <div class="play-button-small">
                                        <span
                                            class="material-symbols-outlined text-white text-[24px] filled">play_arrow</span>
                                    </div>
                                </div>
                                {% if related.duration %}
                                <div class="duration-badge-small">{{ related.duration }}</div>
                                {% endif %}
                            </div>
                            <div class="p-4">
                                <h3 class="text-sm font-bold text-white mb-2 line-clamp-2 leading-tight">
                                    {{ related.title }}
                                </h3>
                                <div class="flex items-center justify-between text-xs text-text-muted">
                                    <span>{{ related.category or 'Tutorial' }}</span>
                                    <span>{{ related.created_at.strftime('%b %d') if related.created_at
                                        else 'Recent' }}</span>
                                </div>
                            </div>
                        </a>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="text-center py-12">
                        <div class="empty-state-icon mx-auto mb-4">
                            <span class="material-symbols-outlined text-4xl text-primary">video_library</span>
                        </div>
                        <p class="text-text-muted">No related videos available</p>
                    </div>
                    {% endif %}

                    <a href="{{ url_for('youtube.videos_list') }}" class="btn-back w-full justify-center">
                        <span class="material-symbols-outlined">arrow_back</span>
                        <span>Back to Videos</span>
                    </a>
                </div>
            </div>
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Scroll Reveal Animation
    document.addEventListener('DOMContentLoaded', function() {
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('revealed');
                }
            });
        }, { threshold: 0.1 });

        document.querySelectorAll('.scroll-reveal').forEach(el => observer.observe(el));
    });
</script>
{% endblock %}