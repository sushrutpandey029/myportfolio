{% extends "base/base.html" %}

{% block content %}
<main class="flex flex-1 justify-center pt-24 pb-8 px-4 md:px-8 xl:px-40">
    <div class="flex w-full max-w-[1200px] flex-col gap-8">
        <!-- Page Header & Admin Controls -->
        <div class="flex flex-col items-center justify-center gap-4 text-center animate-fade-in-down">
            <div class="flex flex-col gap-3 max-w-3xl">
                <h1 class="text-4xl md:text-5xl lg:text-6xl font-black leading-tight tracking-tight text-white">
                    <span class="inline-block animate-slide-in-left">Video Learning</span>
                    <span
                        class="inline-block animate-slide-in-right ml-2 text-transparent bg-clip-text bg-gradient-to-r from-primary to-purple-500 font-black">Center</span>
                </h1>
                <p class="text-base md:text-lg text-text-secondary animate-fade-in font-medium"
                    style="animation-delay: 0.2s">
                    Master your freelance career with tutorials, guides, and success stories.
                </p>
            </div>
            <!-- Admin Only Upload Button (if user is admin) -->
            {% if current_user.is_authenticated and current_user.role == 'admin' %}
            <a href="{{ url_for('admin.video_form') }}"
                class="group flex items-center gap-2 rounded-lg bg-primary/10 px-4 py-2 text-sm font-medium text-primary hover:bg-primary hover:text-white transition-all">
                <span class="material-symbols-outlined text-[20px]">add_circle</span>
                <span>Upload Video</span>
            </a>
            {% endif %}
        </div>

        <!-- Featured Videos Carousel -->
        {% if featured_videos %}
        <div class="relative overflow-hidden rounded-2xl bg-surface-dark border border-white/10 shadow-2xl animate-scale-in"
            style="animation-delay: 0.3s">
            <div class="carousel-container relative">
                {% for video in featured_videos %}
                <div class="carousel-slide {% if loop.index == 1 %}active{% endif %}" data-slide="{{ loop.index0 }}">
                    <div class="grid grid-cols-1 lg:grid-cols-3 min-h-[400px]">
                        <!-- Video Player Area -->
                        <div class="relative col-span-2 bg-black aspect-video lg:aspect-auto">
                            <iframe class="absolute inset-0 w-full h-full"
                                src="https://www.youtube.com/embed/{{ video.video_id }}?rel=0&modestbranding=1"
                                title="{{ video.title }}" frameborder="0"
                                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                allowfullscreen>
                            </iframe>
                        </div>

                        <!-- Video Details -->
                        <div
                            class="flex flex-col justify-center p-6 md:p-8 lg:border-l border-white/10 bg-gradient-to-br from-surface-dark to-black/50">
                            <div
                                class="mb-4 inline-flex items-center gap-2 self-start rounded-full bg-primary/20 px-3 py-1 text-xs font-semibold text-primary border border-primary/30">
                                <span class="material-symbols-outlined text-[14px]">star</span>
                                <span>Featured</span>
                            </div>
                            <h2 class="mb-3 text-2xl font-bold leading-tight text-white line-clamp-2">{{ video.title }}
                            </h2>
                            <p class="mb-6 text-text-secondary line-clamp-3">
                                {{ video.description or 'Learn valuable skills and insights from this featured video.'
                                }}
                            </p>
                            <div class="mt-auto flex items-center gap-4">
                                <a href="{{ url_for('youtube.video_detail', video_id=video.id) }}"
                                    class="flex items-center gap-2 rounded-lg bg-primary px-6 py-2.5 text-sm font-bold text-white transition-all hover:bg-primary-dark hover:scale-105 shadow-lg shadow-primary/25">
                                    <span class="material-symbols-outlined text-[20px]">play_circle</span>
                                    Watch Now
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            <!-- Carousel Controls -->
            <button onclick="prevSlide()"
                class="carousel-btn absolute left-4 top-1/2 -translate-y-1/2 z-10 flex items-center justify-center size-10 rounded-full bg-black/70 backdrop-blur-sm text-white hover:bg-black/90 transition-all hover:scale-110 border border-white/20">
                <span class="material-symbols-outlined">chevron_left</span>
            </button>
            <button onclick="nextSlide()"
                class="carousel-btn absolute right-4 top-1/2 -translate-y-1/2 z-10 flex items-center justify-center size-10 rounded-full bg-black/70 backdrop-blur-sm text-white hover:bg-black/90 transition-all hover:scale-110 border border-white/20">
                <span class="material-symbols-outlined">chevron_right</span>
            </button>

            <!-- Carousel Indicators -->
            <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 z-10">
                {% for video in featured_videos %}
                <button onclick="goToSlide({{ loop.index0 }})"
                    class="carousel-indicator size-2 rounded-full bg-white/40 hover:bg-white/60 transition-all {% if loop.index == 1 %}active bg-white{% endif %}"
                    data-indicator="{{ loop.index0 }}"></button>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Filters & Search Toolbar -->
        <div
            class="sticky top-[73px] z-30 -mx-4 md:-mx-8 xl:-mx-0 rounded-none xl:rounded-xl bg-background-dark/95 backdrop-blur-md px-4 py-4 md:px-8 xl:px-0 border-y border-white/10 xl:border-none">
            <div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
                <!-- Category Pills -->
                <div class="hide-scrollbar flex items-center gap-2 overflow-x-auto pb-1 md:pb-0">
                    <button onclick="filterVideos('all')"
                        class="category-filter whitespace-nowrap rounded-full px-4 py-2 text-sm font-medium shadow-sm ring-1 ring-inset transition-all bg-primary text-white ring-primary data-[active=false]:bg-surface-dark data-[active=false]:text-white data-[active=false]:ring-white/10 data-[active=false]:hover:bg-surface-highlight"
                        data-category="all" data-active="true">
                        All Videos
                    </button>
                    {% for cat in categories %}
                    <button onclick="filterVideos('{{ cat }}')"
                        class="category-filter whitespace-nowrap rounded-full px-4 py-2 text-sm font-medium shadow-sm ring-1 ring-inset transition-all bg-surface-dark text-white ring-white/10 hover:bg-surface-highlight data-[active=true]:bg-primary data-[active=true]:text-white data-[active=true]:ring-primary"
                        data-category="{{ cat }}" data-active="false">
                        {{ cat }}
                    </button>
                    {% endfor %}
                </div>

                <!-- Sort Dropdown -->
                <div class="flex items-center gap-3">
                    <div class="relative hidden md:block">
                        <span
                            class="material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-[20px] text-text-secondary">filter_list</span>
                        <select
                            class="h-10 w-full appearance-none rounded-lg border-0 bg-surface-dark py-0 pl-10 pr-8 text-sm text-white focus:ring-1 focus:ring-primary cursor-pointer">
                            <option>Newest First</option>
                            <option>Most Popular</option>
                            <option>Oldest</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Video Grid -->
        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3 xl:gap-8">
            {% for video in videos.items %}
            <!-- Video Card -->
            <div class="video-card group flex flex-col overflow-hidden rounded-xl bg-surface-dark border border-white/10 shadow-sm hover:shadow-xl hover:shadow-primary/10 transition-all duration-500 hover:translate-y-[-4px] hover:border-primary/30 animate-scale-in"
                style="animation-delay: {{ loop.index0 * 0.1 }}s" data-category="{{ video.category or 'General' }}">
                <div class="relative aspect-video w-full overflow-hidden bg-slate-800">
                    <!-- YouTube Thumbnail -->
                    <div class="absolute inset-0 bg-cover bg-center transition-transform duration-500 group-hover:scale-105"
                        style="background-image: url('https://img.youtube.com/vi/{{ video.video_id }}/hqdefault.jpg');">
                    </div>
                    <div
                        class="absolute inset-0 flex items-center justify-center bg-black/20 opacity-0 transition-opacity duration-300 group-hover:opacity-100">
                        <a href="{{ url_for('youtube.video_detail', video_id=video.id) }}"
                            class="flex size-12 items-center justify-center rounded-full bg-primary text-white shadow-lg">
                            <span class="material-symbols-outlined text-[28px] filled">play_arrow</span>
                        </a>
                    </div>
                    {% if video.duration %}
                    <div
                        class="absolute bottom-3 right-3 rounded bg-black/80 px-2 py-0.5 text-xs font-medium text-white">
                        {{ video.duration }}</div>
                    {% endif %}
                </div>
                <div class="flex flex-1 flex-col p-4">
                    <div class="mb-2 flex items-center justify-between">
                        <span class="text-xs font-semibold uppercase tracking-wider text-primary">{{ video.category or
                            'Tutorial' }}</span>
                        <span class="text-xs text-text-secondary">{{ video.created_at.strftime('%b %d') if
                            video.created_at else 'Recent' }}</span>
                    </div>
                    <h3
                        class="mb-2 text-lg font-bold leading-snug text-white group-hover:text-primary transition-colors">
                        {{ video.title }}</h3>
                    <p class="mb-4 line-clamp-2 text-sm text-text-secondary">{{ video.description or 'Watch this video
                        to learn more about this topic.' }}</p>
                    <div class="mt-auto flex items-center justify-between border-t border-white/10 pt-3">
                        <a href="{{ url_for('youtube.video_detail', video_id=video.id) }}"
                            class="flex items-center gap-1 text-sm font-medium text-text-secondary hover:text-primary transition-colors">
                            <span class="material-symbols-outlined text-[18px]">visibility</span>
                            <span>Watch</span>
                        </a>
                        <button class="text-text-secondary hover:text-primary transition-colors">
                            <span class="material-symbols-outlined text-[20px]">more_vert</span>
                        </button>
                    </div>
                </div>
            </div>
            {% else %}
            <!-- Empty State -->
            <div class="col-span-full flex flex-col items-center justify-center py-16 px-4">
                <div class="size-24 rounded-full bg-surface-highlight flex items-center justify-center mb-6">
                    <span class="material-symbols-outlined text-5xl text-text-secondary">video_library</span>
                </div>
                <h3 class="text-2xl font-bold text-white mb-2">No Videos Available</h3>
                <p class="text-text-secondary text-center max-w-md">
                    There are no videos available at the moment. Check back soon for new content!
                </p>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if videos.pages > 1 %}
        <div class="mt-4 flex items-center justify-center">
            {% if videos.has_prev %}
            <a href="{{ url_for('youtube.videos_list', page=videos.prev_num) }}"
                class="flex h-10 w-10 items-center justify-center rounded-l-lg border border-white/20 bg-surface-dark text-white hover:bg-surface-highlight">
                <span class="material-symbols-outlined">chevron_left</span>
            </a>
            {% else %}
            <span
                class="flex h-10 w-10 items-center justify-center rounded-l-lg border border-white/10 bg-surface-dark/50 text-text-secondary cursor-not-allowed">
                <span class="material-symbols-outlined">chevron_left</span>
            </span>
            {% endif %}

            {% for page_num in videos.iter_pages() %}
            {% if page_num %}
            <a href="{{ url_for('youtube.videos_list', page=page_num) }}"
                class="flex h-10 w-10 items-center justify-center border-y {% if page_num == videos.page %}bg-primary text-white border-primary{% else %}border-white/20 bg-surface-dark text-white hover:bg-surface-highlight{% endif %}">
                {{ page_num }}
            </a>
            {% else %}
            <span
                class="flex h-10 w-10 items-center justify-center border-y border-white/10 bg-surface-dark text-text-secondary">...</span>
            {% endif %}
            {% endfor %}

            {% if videos.has_next %}
            <a href="{{ url_for('youtube.videos_list', page=videos.next_num) }}"
                class="flex h-10 w-10 items-center justify-center rounded-r-lg border border-l-0 border-white/20 bg-surface-dark text-white hover:bg-surface-highlight">
                <span class="material-symbols-outlined">chevron_right</span>
            </a>
            {% else %}
            <span
                class="flex h-10 w-10 items-center justify-center rounded-r-lg border border-l-0 border-white/10 bg-surface-dark/50 text-text-secondary cursor-not-allowed">
                <span class="material-symbols-outlined">chevron_right</span>
            </span>
            {% endif %}
        </div>
        {% endif %}
    </div>
</main>

<style>
    .hide-scrollbar::-webkit-scrollbar {
        display: none;
    }

    .hide-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    .material-symbols-outlined.filled {
        font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }

    /* Entrance Animations */
    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    @keyframes slideInLeft {
        from {
            opacity: 0;
            transform: translateX(-30px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(30px);
        }

        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes scaleIn {
        from {
            opacity: 0;
            transform: scale(0.9);
        }

        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .animate-fade-in-down {
        animation: fadeInDown 0.8s ease-out;
    }

    .animate-fade-in {
        animation: fadeIn 0.6s ease-out backwards;
    }

    .animate-slide-in-left {
        animation: slideInLeft 0.8s ease-out;
    }

    .animate-slide-in-right {
        animation: slideInRight 0.8s ease-out 0.2s backwards;
    }

    .animate-scale-in {
        animation: scaleIn 0.6s ease-out backwards;
    }

    /* Carousel Styles */
    .carousel-slide {
        display: none;
        opacity: 0;
        transition: opacity 0.6s ease-in-out;
    }

    .carousel-slide.active {
        display: block;
        opacity: 1;
    }

    .carousel-indicator.active {
        width: 1.5rem;
        background-color: white;
    }
</style>

<script>
    let currentSlide = 0;
    let autoSlideInterval;
    const slideDelay = 5000; // 5 seconds per slide

    function showSlide(index) {
        const slides = document.querySelectorAll('.carousel-slide');
        const indicators = document.querySelectorAll('.carousel-indicator');

        if (!slides.length) return;

        // Wrap around
        if (index >= slides.length) currentSlide = 0;
        if (index < 0) currentSlide = slides.length - 1;
        if (index >= 0 && index < slides.length) currentSlide = index;

        // Hide all slides
        slides.forEach(slide => slide.classList.remove('active'));
        indicators.forEach(ind => ind.classList.remove('active', 'bg-white'));

        // Show current slide
        slides[currentSlide].classList.add('active');
        indicators[currentSlide].classList.add('active', 'bg-white');
    }

    function nextSlide() {
        showSlide(currentSlide + 1);
        resetAutoSlide();
    }

    function prevSlide() {
        showSlide(currentSlide - 1);
        resetAutoSlide();
    }

    function goToSlide(index) {
        showSlide(index);
        resetAutoSlide();
    }

    function startAutoSlide() {
        autoSlideInterval = setInterval(() => {
            showSlide(currentSlide + 1);
        }, slideDelay);
    }

    function resetAutoSlide() {
        clearInterval(autoSlideInterval);
        startAutoSlide();
    }

    // Initialize carousel on page load
    document.addEventListener('DOMContentLoaded', function () {
        const slides = document.querySelectorAll('.carousel-slide');
        if (slides.length > 1) {
            startAutoSlide();
        }
    });

    // Client-side filtering function
    function filterVideos(category) {
        const videoCards = document.querySelectorAll('.video-card');
        const filterButtons = document.querySelectorAll('.category-filter');

        // Update active state on filter buttons
        filterButtons.forEach(btn => {
            if (btn.dataset.category === category) {
                btn.dataset.active = 'true';
                btn.classList.remove('bg-surface-dark', 'ring-white/10');
                btn.classList.add('bg-primary', 'ring-primary', 'text-white');
            } else {
                btn.dataset.active = 'false';
                btn.classList.remove('bg-primary', 'ring-primary');
                btn.classList.add('bg-surface-dark', 'ring-white/10');
            }
        });

        // Filter video cards with smooth animation
        videoCards.forEach((card, index) => {
            const cardCategory = card.dataset.category;

            if (category === 'all' || cardCategory === category) {
                // Show card with staggered animation
                setTimeout(() => {
                    card.style.display = 'flex';
                    card.style.opacity = '0';
                    card.style.transform = 'scale(0.9)';

                    setTimeout(() => {
                        card.style.transition = 'opacity 0.4s ease-out, transform 0.4s ease-out';
                        card.style.opacity = '1';
                        card.style.transform = 'scale(1)';
                    }, 10);
                }, index * 50);
            } else {
                // Hide card
                card.style.transition = 'opacity 0.3s ease-out, transform 0.3s ease-out';
                card.style.opacity = '0';
                card.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    card.style.display = 'none';
                }, 300);
            }
        });
    }
</script>
{% endblock %}